<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Learn Egyptian</title>
    <script type="text/javascript" src="elm.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div id="myapp"></div>
</body>

<script type="text/javascript">
    var app = Elm.Main.init({
        node: document.getElementById('myapp'),
        // TODO: also do a search of the English because we want to store one vocab PER meaning.
        // For English->Eg when there's multiple words that mean the same thing in English, when you're tested you should be asked if you can recall another word for it. Ideally though we should just have a better way to mark the english side of the vocab with a special note. We should be able to mark either EG or Eng side of vocab with a note.
        flags: { sm2FlashcardData: Array.from(getEgyptianWords()).map(word => getLocally(word)) }
    });

    app.ports.storeFlashcardEntry.subscribe(function (entry) {
        const { egyptian, english, englishData, egyptianData } = entry;

        // Add entry to lookup table used to load data on app init.
        const egyptianWords = getEgyptianWords();
        egyptianWords.add(egyptian);
        storeLocally('egyptian-words', Array.from(egyptianWords));
        console.log(egyptianWords);

        storeLocally(egyptian, entry);
        console.log({ egyptian, english, englishData, egyptianData });
    });

    /// Lists all egyptian words stored in vocab.
    function getEgyptianWords() {
        return new Set(getLocally('egyptian-words') || []);
    }

    function storeLocally(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    function getLocally(key) {
        return JSON.parse(localStorage.getItem(key));
    }

</script>

</html>