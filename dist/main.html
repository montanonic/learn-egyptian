<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Learn Egyptian</title>
    <script type="text/javascript" src="elm.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div id="myapp"></div>
</body>

<script type="text/javascript">
    var app = Elm.Main.init({
        node: document.getElementById('myapp'),
        // TODO: also do a search of the English because we want to store one vocab PER meaning.
        // For English->Eg when there's multiple words that mean the same thing in English, when you're tested you should be asked if you can recall another word for it. Ideally though we should just have a better way to mark the english side of the vocab with a special note. We should be able to mark either EG or Eng side of vocab with a note.
        flags: {
            sm2FlashcardData: Array.from(getEgyptianWords()).map(word => getLocally(word))
            , lessons: getLocally('allLessons') || []
        }
    });

    // An easier hack than dealing with lesson individually, that is also less performant.
    app.ports.storeLessonData.subscribe(function (lessons) {
        storeLocally('allLessons', lessons);
    });

    // The below code is fine, but it's easier to manage entire sets of data in bulk, albeit much less performant as the size of data increases. For our early app, this is fine.

    // app.ports.storeNewLesson.subscribe(function ([title, text]) {
    //     storeLesson(title, text);
    // });

    // // returns List (title, text)
    // function getLessonDict() {
    //     const lessonTitles = getLocally('lessonTitles') || [];
    //     return lessonTitles.map(title => [title, getLesson(title)])
    // }

    // function getLesson(title) {
    //     return getLocally(`lesson-${title}`);
    // }

    // function getLessonTitles() {
    //     return getLocally('lessonTitles');
    // }

    // function storeLesson(title, text) {
    //     storeLocally('lessonTitles', [...getLessonTitles(), title]); // index it
    //     return storeLocally(`lesson-${title}`, text);
    // }

    // TODO: Bad code
    app.ports.storeFlashcardEntry.subscribe(function (entry) {
        const { egyptian, english, englishData, egyptianData } = entry;

        // Add entry to lookup table used to load data on app init.
        const egyptianWords = getEgyptianWords();
        egyptianWords.add(egyptian);
        storeLocally('egyptianWords', Array.from(egyptianWords));
        console.log(egyptianWords);

        storeLocally(`word-${egyptian}`, entry);
        console.log({ egyptian, english, englishData, egyptianData });
    });

    /// Lists all egyptian words stored in vocab.
    function getEgyptianWords() {
        return new Set(getLocally('egyptianWords') || []);
    }

    function storeLocally(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    function getLocally(key) {
        return JSON.parse(localStorage.getItem(key));
    }

</script>

</html>